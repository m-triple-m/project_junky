{% extends 'base.html' %}

{% block css %}

    <style>
        .browse{
            cursor: pointer;
    }
    </style>
{% endblock %}
{% block body %}
<div class="container">
    <div class="row"></div>
    <div class="card">
        <div class="card-header">
            <div class="card-title"><h1 class="display-4">Scan Malicious files in your System</h1></div>
            <div method="post" class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text">select a drive</span>
                </div>
                <input list="drives" class="form-control" id="dirname" placeholder="C: drive">
                <datalist id="drives">
                  <option value="c:/">
                  <option value="d:/">
                  <option value="e:/">
                </datalist>
                <div class="input-group-append">
                    <button class="btn btn-danger" id="getdir">browse</button>  
                </div>

            </div>            
        </div>
        <div class="card-body">
            {% for dir in dirs %}
                <p class="h6">{{dir}}</p>
            {% endfor %}
        </div>

        <button id="back" class="btn btn-secondary">Back</button>
        <table class="table">
            <tbody id="listDir"></tbody>
        </table>
    </div>
</div>

<div id="result"></div>
{% endblock %}
{% block js %}
    <script>
        $(document).ready(() => {
            // $('#loader').hide();
            var items;
            var current;
            getList = (input) => {
                
                if(!input){
                    alert('no input!!')
                    return;
                }
                $.get('/dir', {path : input}, (data) => {
                    console.log(data);
                    if(data[0]){
                        items = data[0];
                        current = data[1]
                        $('#listDir').html('');
                        items.forEach((ele, index) => {
                            $('#listDir').append(`<tr><td class="browse" onClick="selectDir(${index})">${ele}</td>  <td><a class="btn btn-primary"  onClick = "scanDir(${index})">Scan Junk</a></td></tr>`)
                        })
                        }
                })
            }

            selectDir = (index) => {
                console.log(index);
                getList(items[index])
            }

            $('#back').click(() => {
                input = '..';
                getList(input);
            })

            $('#getdir').click(() => {
                input = $('#dirname').val();
                getList(input);
            })

            scanDir = (index) => {
                $.ajax({url : '/scanMalware', data : {path : `${current}/${items[index]}`}, method : "get", complete : (data) => {
                    console.log(data);
                    sessionStorage.setItem('data', JSON.stringify(data.responseJSON));
                    window.location.replace('/showmal')
                },
                beforeSend: () => {
                    Swal.fire({
                        title: 'Scanning Malware!',
                        html: 'This may take some time',
                        timerProgressBar: true,
                        onBeforeOpen: (
                            
                        ) => {
                            Swal.showLoading();
                        },
                        })
                },
                })
            }
        })
    </script>
{% endblock %}

